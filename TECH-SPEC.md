# Technical Specification for Mekane Share

## 1. Overview
This document details the technical implementation of Mekane Share, a Chrome extension for capturing and sharing screenshots with user-configurable hosting. It complements the PRD, focusing on "how" to build the product.

## 2. General Architecture
- **Frontend:** Chrome extension using React and WXT.
- **Backend:** Node.js with TypeScript and Hono for hosting and storing screenshots.
- **Repository Structure:** Monorepo managed with Turborepo, containing two apps: `extension` and `backend`.

## 3. Specific Technologies
### 3.1. Frontend (Chrome Extension)
- **Framework:** React with WXT for extension development.
- **Language:** TypeScript (aligned with the backend).
- **Libraries:**
  - `react` and `react-dom` for rendering.
  - `wxt` for extension structure and automation.
  - `webextension-polyfill` for Chrome API compatibility.
- **Build:** Vite (embedded in WXT) for HMR and bundling.
- **File Structure:**
  - `apps/extension/entrypoints/content.tsx` – React overlay for capture and annotations.
  - `apps/extension/entrypoints/background.ts` – Logic for capture and backend communication.
  - `apps/extension/entrypoints/popup.tsx` – Settings panel (server selection).
  - `apps/extension/manifest.json` – Automatically generated by WXT.

### 3.2. Backend
- **Framework:** Hono for routing and middleware.
- **Language:** TypeScript.
- **Node.js Version:** v22+.
- **Storage:** Local filesystem or user-configurable storage (e.g., via `STORAGE_PATH`).
- **Endpoints:**
  - `POST /upload` – Receives image, stores locally, returns URL.
  - `GET /health` – Returns 200 status if active.
- **Retention:** 1 week for stored images (v1), configurable by the user.
- **Dependencies:**
  - `hono` for routing.
  - `sharp` for image compression and processing.
- **Configuration:**
  - Environment variables: `PORT`, `STORAGE_PATH`, `HTTPS_CERT`, `HTTPS_KEY`.

**Minimum Requirements:**
- 512MB RAM, 1GB storage, HTTPS enabled.

## 4. Technical Flows
### 4.1. Capture and Sharing
1. User clicks the extension icon.
2. `content.tsx` renders a React overlay with options (full page or area).
3. `background.ts` uses `chrome.tabs.captureVisibleTab` or `chrome.scripting` for capture.
4. Overlay allows adding arrows/text with React state.
5. Image is sent via fetch to the configured backend: `POST /upload` to the URL set in `popup.tsx`.
6. Returned URL is copied using `navigator.clipboard.writeText`.

### 4.2. Server Configuration
- `popup.tsx` (React) saves the backend URL to `chrome.storage`.
- Connection test: `fetch(/health)` with a 500ms timeout.
- Displays an error to the user if the connection fails, without automatic fallback.

## 5. Monorepo Structure
- **Root:** `mekane-share/`
  - `apps/extension/` – Chrome extension code (React/WXT/TypeScript).
  - `apps/backend/` – Backend code (TypeScript/Hono).
  - `packages/shared/` – Shared code (e.g., TypeScript types, URL validation).
- **Management:** Turborepo for build, lint, and test workflows.
- **TypeScript Configuration:**
  - `tsconfig.json` in each app, inheriting from a root `tsconfig.base.json`.
- **Turborepo Configuration:**
  - `turbo.json` defines pipelines for `build`, `dev`, and `test` across the two apps.

## 6. Setup and Deployment
- **Extension:** `turbo run dev --filter=extension` for development with HMR; `turbo run build --filter=extension` followed by `wxt zip` for Chrome Web Store publication.
- **Backend:** `turbo run start --filter=backend` after configuring `.env` and HTTPS certificates.

## 7. Testing
- **Unit Tests:** Jest for React and backend TypeScript (with `@hono/test` for Hono).
- **Integration Tests:** Playwright to simulate capture and upload.
- **Performance:** Measure capture + URL generation time (<2s).
## 8. Useful Links
- [Elem Snap](https://elemsnap.com/) - A reference resource for screenshot sharing solutions.
